const axios = require("axios");

async function subscribeToPointsRedemption() {
  const resp = await axios.post(
    "https://api.twitch.tv/helix/eventsub/subscriptions",
    {
      type: "channel.channel_points_custom_reward_redemption.add",
      version: "1",
      condition: {
        broadcaster_user_id: process.env.TWITCH_BROADCASTER_ID
      },
      transport: {
        method: "webhook",
        callback: process.env.BASE_URL + "/eventsub",
        secret: process.env.TWITCH_EVENTSUB_SECRET
      }
    },
    {
      headers: {
        "Client-ID": process.env.TWITCH_CLIENT_ID,
        Authorization: `Bearer ${process.env.TWITCH_APP_TOKEN}`,
        "Content-Type": "application/json"
      }
    }
  );

  console.log("Subscribed:", resp.data);
}

module.exports = { subscribeToPointsRedemption };
